<div *ngIf="showVisualizer">
  <div class="tree">
    <h3 style="margin-top: 2rem; font-style: italic; font-family: serif;">
      Formula Visualizer
    </h3>
    <ng-template
      #recursiveList
      let-node="node"
      let-preNode="preNode"
      let-argInd="argInd"
    >
      <ng-container *ngIf="node.type == 'PAREN'">
        <ng-container
          *ngTemplateOutlet="
            node.type == 'PAREN' ? recursiveList : '';
            context: { node: node.expression, preNode: node }
          "
        ></ng-container>
      </ng-container>
      <!-- Rebdering BINARY ARITHMATIC-->
      <div
        *ngIf="
          node.type == 'DIVISION' ||
          node.type == 'ADDITION' ||
          node.type == 'SUBTRACTION' ||
          node.type == 'MULTIPLICATION'
        "
        class="node form-group"
      >
        <div class="tree-add-button">
          <i
            (click)="addNode(node, preNode, argInd)"
            title="Add Node"
            class="fa text-primary fa-plus-circle"
          ></i>
        </div>

        <div class="tree-del-button">
          <i
            title="Remove Node"
            (click)="removeNode(node, preNode, argInd)"
            class="fa fa-times-circle text-danger"
          ></i>
        </div>
        <div>
          <select
            class="selectdropdown"
            style="background-color:#66ff33;"
            name="operation"
            id="operation"
            (change)="changeOption($event, node)"
          >
            <option
              class="opdropdown"
              *ngFor="let op of operations"
              value="op"
              [selected]="op == node.type"
            >
              {{ op }}
            </option>
          </select>
        </div>
        <div>
          <!-- Render LEFT NODE if available-->
          <ng-container
            *ngTemplateOutlet="
              node.left != undefined ? recursiveList : '';
              context: { node: node.left, preNode: node }
            "
          ></ng-container>
          <!-- Render RIGHT NODE if available-->
          <ng-container
            *ngTemplateOutlet="
              node.right != undefined ? recursiveList : '';
              context: { node: node.right, preNode: node }
            "
          ></ng-container>
        </div>
      </div>
      <!-- Rendering BINARY VARIABLE -->
      <div class="node" *ngIf="node.type == 'VARIABLE'">
        <div class="tree-add-button">
          <i
            (click)="addNode(node, preNode, argInd)"
            title="Add Node"
            class="fa text-primary fa-plus-circle"
          ></i>
        </div>
        <div class="tree-del-button">
          <i
            title="Remove Node"
            (click)="removeNode(node, preNode, argInd)"
            class="fa fa-times-circle text-danger"
          ></i>
        </div>
        <div>
          <select
            class="selectdropdown"
            style="background-color:#ccffcc;"
            name="operation"
            id="operation"
            (change)="changeOption($event, node, node.type)"
          >
            <option
              class="opdropdown"
              *ngFor="let op of operations"
              value="op"
              [selected]="op == node.type"
            >
              {{ op }}
            </option>
          </select>
        </div>
        <div>
          <input
            [ngClass]="{ inValid: node.name == null || node.name == '' }"
            (input)="onInputChange($event, node)"
            type="text"
            style="max-width: 5rem;margin-top: 0.5rem;"
            name="varVal"
            [value]="node.name"
          />
        </div>
      </div>
      <!-- Rendering BINARY FUNCTION -->
      <div class="node" *ngIf="node.type == 'FUNCTION'">
        <div class="tree-add-button">
          <i
            (click)="addNode(node, preNode, argInd)"
            title="Add Node"
            class="fa text-primary fa-plus-circle"
          ></i>
        </div>
        <div class="tree-del-button">
          <i
            title="Remove Node"
            (click)="removeNode(node, preNode, argInd)"
            class="fa fa-times-circle text-danger"
          ></i>
        </div>
        <div>
          <select
            class="selectdropdown"
            style="background-color:red;"
            name="operation"
            id="operation"
            (change)="changeOption($event, node)"
          >
            <option
              class="opdropdown"
              *ngFor="let op of operations"
              value="op"
              [selected]="op == node.name"
            >
              {{ op }}
            </option>
          </select>
        </div>

        <ng-template #function let-args="args">
          <div>
            <div *ngFor="let arg of args; let ind = index">
              <ng-container
                *ngTemplateOutlet="
                  recursiveList;
                  context: { node: arg, preNode: node, argInd: ind }
                "
              ></ng-container>
            </div>
          </div>
        </ng-template>

        <ng-container
          *ngTemplateOutlet="
            node.type == 'FUNCTION' ? function : '';
            context: { args: node.arguments }
          "
        >
        </ng-container>
      </div>

      <div class="node" *ngIf="node.type == 'NUMBER'">
        <div class="tree-add-button">
          <i
            (click)="addNode(node, preNode, argInd)"
            title="Add Node"
            class="fa text-primary fa-plus-circle"
          ></i>
        </div>
        <div class="tree-del-button">
          <i
            title="Remove Node"
            (click)="removeNode(node, preNode, argInd)"
            class="fa fa-times-circle text-danger"
          ></i>
        </div>
        <div>
          <select
            class="selectdropdown"
            style="background-color:#ccffcc;"
            name="operation"
            id="operation"
            (change)="changeOption($event, node, node.type)"
          >
            <option
              class="opdropdown"
              *ngFor="let op of operations"
              value="op"
              [selected]="op == node.type"
            >
              {{ op }}
            </option>
          </select>
        </div>
        <div>
          <input
            [ngClass]="{ inValid: node.value == null || node.value == '' }"
            (input)="onInputChange($event, node)"
            style="max-width: 5rem; margin-top: 0.5rem;"
            type="number"
            step="0.1"
            name="numVal"
            [value]="node.value"
          />
        </div>
      </div>

      <div class="node" *ngIf="node.type == 'PI'">
        <div class="tree-add-button">
          <i
            (click)="addNode(node, preNode, argInd)"
            title="Add Node"
            class="fa text-primary fa-plus-circle"
          ></i>
        </div>
        <div class="tree-del-button">
          <i
            title="Remove Node"
            (click)="removeNode(node, preNode, argInd)"
            class="fa fa-times-circle text-danger"
          ></i>
        </div>
        <div>
          <select
            class="selectdropdown"
            style="background-color:#ccffcc;"
            name="operation"
            id="operation"
            (change)="changeOption($event, node, node.type)"
          >
            <option
              class="opdropdown"
              *ngFor="let op of operations"
              value="op"
              [selected]="op == node.type"
            >
              {{ op }}
            </option>
          </select>
        </div>
      </div>
    </ng-template>
    <ng-container
      *ngTemplateOutlet="
        recursiveList;
        context: { node: syntaxTree, preNode: {} }
      "
    ></ng-container>
  </div>
  <div>
    <button
      style="margin:0.5rem;padding:0.5rem"
      class="btn btn-primary"
      (click)="astToFormula()"
      [disabled]="!isValid"
    >
      Convert Visualizer to Formula
    </button>
  </div>
</div>
